# 神鹰附魔修改记录

## 修改日期
2025年9月21日

## 修改内容概述
将神鹰附魔扩展为万能附魔，既保留原有的武器主动攻击功能，又新增了盔甲被动防护功能，类似于荆棘附魔的机制。

## 具体修改

### 1. 附魔类别变更
- **修改前**: 武器附魔 (EnchantmentCategory.WEAPON)
- **修改后**: 万能附魔 (EnchantmentCategory.BREAKABLE)
- **适用装备**: 武器、头盔、胸甲、护腿、靴子、木棍

### 2. 触发机制变更
- **武器模式**: 保留原有的攻击敌人时触发 (doPostAttack方法)
- **盔甲模式**: 新增受到攻击时触发 (LivingHurtEvent事件)

### 3. 效果机制

#### 武器模式（主动攻击）
- **触发条件**: 使用神鹰附魔武器攻击敌人时
- **效果对象**: 被攻击的目标被击飞并受到坠落伤害
- **最高等级**: 5级
- **击飞强度**: 基础0.75 + 等级×0.5的向上速度
- **坠落伤害**: 每级5%的最大生命值百分比伤害（1级5%，2级10%，3级15%，4级20%，5级25%）
- **木棍特殊**: 只击飞不造成坠落伤害

#### 盔甲模式（被动防护）
- **触发条件**: 穿戴神鹰附魔盔甲的玩家受到攻击时
- **效果对象**: 攻击者被击飞并受到坠落伤害
- **最高等级**: 5级（单件盔甲）
- **等级叠加**: 多件盔甲的附魔等级会叠加，最高有效等级为10级
- **击飞强度**: 基础0.5 + 等级×0.2的向上速度
- **坠落伤害**: 每级5%的最大生命值百分比伤害（最高10级50%）

### 4. 音效系统
- **起飞音效**: 当目标被击飞时播放"飞起来"音效
- **落地音效**: 目标落地时播放"man"音效
- **死亡音效**: 如果目标因坠落死亡，播放"hahaha"音效
- **防重复播放**: 
  - 武器模式：1秒内不会重复播放起飞音效
  - 盔甲模式：2秒内不会重复播放起飞音效

### 5. 代码文件修改

#### ShenYingEnchantment.java
- 保留了doPostAttack方法（武器主动攻击功能）
- 修改构造函数，改为万能附魔
- 更新canApplyAtEnchantingTable和canEnchant方法，支持武器和盔甲
- 区分武器和盔甲的音效标记，避免冲突

#### ModEventHandlers.java
- 新增LivingHurtEvent事件监听（盔甲被动防护功能）
- 实现被动触发逻辑
- 支持多件盔甲等级叠加
- 分别处理武器和盔甲的音效播放计时器

#### 语言文件
- 更新中文和英文描述，说明武器和盔甲的双重功能

## 功能特点

### 双重模式
- **武器模式**: 保留原有的主动攻击功能，击飞效果更强
- **盔甲模式**: 新增被动防护功能，类似荆棘附魔

### 等级叠加
- **武器**: 单一武器的附魔等级决定效果强度
- **盔甲**: 支持在多个盔甲部位附魔，等级会叠加，最高有效等级限制为5

### 平衡性
- 统一伤害计算：每级5%生命值伤害，最高25%（武器）或50%（盔甲叠加）
- 武器和盔甲模式有不同的击飞强度计算
- 坠落伤害基于百分比，对不同生命值的敌人都有效
- 分别的音效冷却时间防止过度干扰
- 木棍特殊处理，只击飞不伤害
- 最高等级提升到5级，但伤害大幅降低，更加平衡

## 使用方法

### 武器模式
1. 在附魔台上将神鹰附魔应用到武器或木棍上
2. 使用附魔武器攻击敌人
3. 敌人会被击飞并在落地时受到坠落伤害（木棍除外）

### 盔甲模式
1. 在附魔台上将神鹰附魔应用到盔甲上
2. 穿戴附魔盔甲
3. 当受到攻击时，攻击者会被自动击飞
4. 攻击者落地时会受到坠落伤害

## 兼容性
- 完全保持了原有的武器攻击功能
- 保持了原有的音效系统
- 保持了坠落伤害机制
- 向后兼容旧版本的数据标签
- 武器和盔甲使用独立的音效标记，避免冲突

## 更新说明
**2025年9月21日更新**: 
1. 修复了武器附魔失效的问题，现在神鹰附魔既支持武器主动攻击，也支持盔甲被动防护，实现了真正的万能附魔。
2. 平衡性调整：
   - 最高等级从3级提升到5级
   - 统一伤害计算：每级5%生命值伤害
   - 武器模式：最高25%伤害（5级）
   - 盔甲模式：支持等级叠加，最高50%伤害（4件5级盔甲）
   - 大幅降低了伤害，避免过于超模

### 2025年9月21日增强（铁傀儡）
- 为原版铁傀儡赋予“内置神鹰II”效果：
  - 玩家攻击铁傀儡：玩家被击飞（等效盔甲被动，最低有效等级视为2）
  - 铁傀儡攻击玩家：玩家被击飞，并按10%最大生命值标记坠落伤害（等效武器模式Lv2）
- 实现方式：
  - 在 ModEventHandlers.onLivingHurt 中：
    - 若攻击者是 IronGolem：按武器模式Lv2对受害者施加 1.75 的向上速度与10%坠落伤害标记，并复用武器模式音效冷却键
    - 若受害者是 IronGolem：将其盔甲总等级至少提升为2，从而触发对攻击者的击飞
  - 落地额外伤害与音效继续由现有 onLivingFall/onLivingDeath 处理
- 兼容性：不改变任何装备附魔；复用既有音效冷却与数据标签；不影响非铁傀儡生物逻辑

### 2025年9月21日增强（铁傀儡机动性与反制垫塔）
- 常驻速度V：服务器端每tick确保铁傀儡拥有速度效果V（放大4），20秒时长循环续期，隐藏粒子。
- 跳跃搭方块：当目标高于铁傀儡≥3格时，每10tick触发一次“起跳→2tick后在记录脚下位置放置一块圆石”，仅在该位置为空气时落块，避免与实体占位冲突；使用 NBT 维护 golem_stack_cooldown、golem_place_timer 与 golem_last_ground_(x,y,z)。
- 最小侵入：逻辑写于 ModEventHandlers.onLivingTick，服务端执行，复用原有事件总线，无需修改原版实体类或AI任务。